<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Boutique Group â€“ Facility Management Complaint Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root { --bottle: #0b6b3a; --bottle-600: #0a5e33; --bottle-50: #e6f3ec; }
    body { background: #f0f2f5 }
    .brand-text { color: var(--bottle); }
    .card { border-top: 4px solid var(--bottle); }
    .form-section-title { color: var(--bottle); font-weight: 600; }
    .badge-bottle { background-color: var(--bottle); }
    .btn-bottle { background-color: var(--bottle); border-color: var(--bottle); }
    .btn-bottle:hover { background-color: var(--bottle-600); border-color: var(--bottle-600); }
    .helper { color: #6c757d; font-size: .875rem; }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="card shadow p-4" style="max-width:900px;margin:auto;">
      <div class="d-flex flex-column align-items-center text-center mb-3">
        <span class="badge rounded-pill badge-bottle mb-2">Boutique Group</span>
        <h4 class="mb-1 brand-text">Facility Management Complaint Form</h4>
        <div class="helper">Please share complete details. Our team will reach out shortly.</div>
      </div>
      <form id="complaintForm" novalidate>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Ticket ID</label>
            <input type="text" id="ticketId" class="form-control" readonly />
          </div>
          <div class="col-md-6">
            <label class="form-label">Date</label>
            <input type="text" id="date" class="form-control" readonly />
          </div>
          <div class="col-md-6">
            <label class="form-label">Full Name <span class="text-danger">*</span></label>
            <input type="text" id="name" class="form-control" placeholder="e.g. Abdulaziz K. Aljehni" required />
            <div class="invalid-feedback">Name is required.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Email <span class="text-danger">*</span></label>
            <input type="email" id="email" class="form-control" placeholder="e.g. ali@example.com" required />
            <div class="invalid-feedback">Valid email is required.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Contact Number <span class="text-danger">*</span></label>
            <input type="tel" id="contact" class="form-control" placeholder="e.g. 05-xxxxxxx" required />
            <div class="invalid-feedback">Contact number is required.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Preferred Contact</label>
            <select id="preferredContact" class="form-select">
              <option value="Phone" selected>Phone</option>
              <option value="Email">Email</option>
              <option value="WhatsApp">WhatsApp</option>
            </select>
          </div>
        </div>

        <hr class="my-4" />
        <div class="form-section-title mb-2">Location Details</div>
        <div class="row g-3">
        


          <div class="col-md-6">
            <label class="form-label">Floor <span class="text-danger">*</span></label>
            <select id="floor" class="form-select" required>
              <option value="">-- Select Floor --</option>
              <option>8th Floor</option>
              <option>11th Floor</option>
              <option>12th Floor</option>
            </select>
            <div class="invalid-feedback">Please select a floor.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Location / Room <span class="text-danger">*</span></label>
            <input type="text" id="location" class="form-control" placeholder="e.g. 11-Meeting Room" required />
            <div class="invalid-feedback">Location/Room is required.</div>
          </div>
         
          <div class="col-12">
            <label class="form-label">Location Detail <span class="text-danger">*</span></label>
            <textarea id="locationDetail" class="form-control" rows="4" required></textarea>
            <div class="invalid-feedback">Location detail is required.</div>
          </div>
        </div>

        <hr class="my-4" />
        <div class="form-section-title mb-2">Issue Details</div>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Category <span class="text-danger">*</span></label>
            <select id="category" class="form-select" required>
              <option value="">-- Select Category --</option>
              <option>Electrical</option>
              <option>Plumbing</option>
              <option>HVAC</option>
              <option>Cleaning</option>
              <option>Security</option>
              <option>IT Support</option>
              <option>Other</option>
            </select>
            <div class="invalid-feedback">Please select a category.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Priority <span class="text-danger">*</span></label>
            <select id="priority" class="form-select" required>
              <option value="">-- Select Priority --</option>
              <option>Low</option>
              <option>Medium</option>
              <option>High</option>
              <option>Urgent</option>
            </select>
            <div class="invalid-feedback">Please select priority.</div>
          </div>
          <div class="col-12">
            <label class="form-label">Issue Description <span class="text-danger">*</span></label>
            <textarea id="issueDescription" class="form-control" rows="4" placeholder="Describe the problem, impact, and any reference numbers" required></textarea>
            <div class="helper">Example: AC not cooling in 11-Conference A since morning.</div>
            <div class="invalid-feedback">Description is required.</div>
          </div>
          <!-- <div class="col-md-6">
            <label class="form-label">Upload Photo</label>
            <input type="file" id="photo" class="form-control" accept="image/*" />
            <div class="helper">Optional but helpful for quicker resolution.</div>
          </div> -->
       
          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="yes" id="agree" required />
              <label class="form-check-label" for="agree">
                I confirm the details are accurate and agree to be contacted.
              </label>
              <div class="invalid-feedback">Please confirm before submitting.</div>
            </div>
          </div>
        </div>

        <div class="mt-4 d-grid d-sm-flex gap-2">
          <button id="submitBtn" type="submit" class="btn btn-bottle px-4">
            <span id="btnSpinner" class="spinner-border spinner-border-sm me-2 d-none" role="status" aria-hidden="true"></span>
            Submit Complaint
          </button>
          <button type="reset" class="btn btn-outline-secondary px-4">Clear</button>
        </div>
        <div class="mt-2 helper">
          Note: <span class="brand-text">Our designated person will resolve your issue and contact you shortly.</span>
        </div>
      </form>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title brand-text">Complaint Submitted</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body pt-0">
          Thank you! Our designated person will resolve your issue soon and will get in touch with you.
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-bottle" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzBbtZmuxPe2sdOZ1VrLPyCQGepceGcQFE_zyM207PR0e5uW0s9HoK0DNJWTRW-WHiBMQ/exec";
  const form = document.getElementById('complaintForm');
  const submitBtn = document.getElementById('submitBtn');
  const btnSpinner = document.getElementById('btnSpinner');
  const ticketIdInput = document.getElementById('ticketId');
  const dateInput = document.getElementById('date');

  function pad(number) { return number.toString().padStart(2, '0'); }
  function todayDateString() {
    const d = new Date();
    const y = d.getFullYear();
    const m = pad(d.getMonth() + 1);
    const day = pad(d.getDate());
    return `${y}-${m}-${day}`; // YYYY-MM-DD
  }
  function generateTicketId() {
    const d = new Date();
    const y = d.getFullYear();
    const m = pad(d.getMonth() + 1);
    const day = pad(d.getDate());
    const rand = Math.floor(Math.random() * 900000) + 100000; // 6-digit
    return `BG-${y}${m}${day}-${rand}`;
  }

  // Prefill Ticket ID and Date
  ticketIdInput.value = generateTicketId();
  dateInput.value = todayDateString();

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!form.checkValidity()) {
      form.classList.add('was-validated');
      return;
    }

    const photoInput = document.getElementById('photo');
    let photoUrl = "";
    if (photoInput && photoInput.files && photoInput.files[0]) {
      // TODO: Upload to Drive if needed
      photoUrl = "Uploaded to Drive";
    }

    const formData = {
      ticketId: document.getElementById('ticketId').value,
      date: document.getElementById('date').value, // YYYY-MM-DD only
      name: document.getElementById('name').value,
      email: document.getElementById('email').value,
      contact: document.getElementById('contact').value,
      preferredContact: document.getElementById('preferredContact').value,
      floor: document.getElementById('floor').value,
      location: document.getElementById('location').value,
      locationDetail: document.getElementById('locationDetail').value,
      category: document.getElementById('category').value,
      priority: document.getElementById('priority').value,
      issueDescription: document.getElementById('issueDescription').value,
      photoUrl: photoUrl
    };

    try {
      submitBtn.disabled = true;
      btnSpinner.classList.remove('d-none');
      const res = await fetch(scriptURL, {
      method: 'POST',
      body: JSON.stringify(formData)
    });
      if (!res.ok) throw new Error('Network response was not ok');
      form.reset();
      form.classList.remove('was-validated');
      const modalEl = document.getElementById('successModal');
      const modal = new bootstrap.Modal(modalEl);
      // Optionally include Ticket ID in the modal body
      const bodyEl = modalEl.querySelector('.modal-body');
      if (bodyEl) {
        bodyEl.innerHTML = `Thank you! Our designated person will resolve your issue soon and will get in touch with you..<br/><strong>Ticket ID:</strong> ${formData.ticketId}`;
      }
      modal.show();
    } catch (err) {
      alert("Error: " + err.message);
    } finally {
      submitBtn.disabled = false;
      btnSpinner.classList.add('d-none');
    }
  });
</script>
</body>
</html>
